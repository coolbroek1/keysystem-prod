<!doctype html><meta charset="utf-8">
<style>
  body{margin:0;font-family:system-ui,Arial;background:#0b1220;color:#e8ecf4;display:grid;place-items:center;height:100vh}
  .card{background:#131b2c;padding:22px 24px;border-radius:14px;max-width:520px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .muted{color:#9aa3b2;font-size:14px}
</style>
<div class="card">
  <b>Verifying step 2…</b>
  <div id="msg" class="muted">Please wait (hash check)…</div>
</div>
<script>
(async function(){
  const params = new URLSearchParams(location.search);
  const hash = params.get("hash");
  const hwid = localStorage.getItem("hwid") || params.get("hwid") || "";
  const msg = document.getElementById("msg");

  if (!hash || hash.length !== 64) {
    msg.textContent = "Missing Linkvertise hash. Open the link again from the portal.";
    return;
  }

  try {
    const r = await fetch(`/.netlify/functions/lv-verify?step=2&hash=${encodeURIComponent(hash)}`, { method:"POST" });
    const d = await r.json();
    if (d.ok) {
      try{ localStorage.setItem("lv2","1"); }catch(_){}
      const qs = [];
      if (hwid) qs.push("hwid="+encodeURIComponent(hwid));
      qs.push("lv=2");
      location.replace("/" + (qs.length?("?"+qs.join("&")):""));
      return;
    }
    msg.textContent = "Verification failed. Try the step again.";
  } catch(e){
    msg.textContent = "Network error. Try again.";
  }
})();
</script>
